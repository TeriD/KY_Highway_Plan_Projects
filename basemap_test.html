<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basemap Control Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="css/style.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { height: 100vh; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Define basemaps
        const basemaps = {
            OpenStreetMap: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }),

            'Esri World Street Map': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012'
            }),

            'USGS Topo': L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer/tile/{z}/{y}/{x}', {
                maxZoom: 20,
                attribution: 'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>'
            }),

            'OpenCycleMap': L.tileLayer('https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors<br><small>Note: May require API key for full access</small>',
                maxZoom: 22
            })
        };

        let currentBasemap = 'OpenStreetMap';

        // Basemap control functions
        function createBasemapControl(map) {
            const control = L.control({ position: 'topright' });

            control.onAdd = function() {
                const div = L.DomUtil.create('div', 'basemap-control');

                div.innerHTML = `
                    <button class="basemap-toggle-btn" title="Change Basemap">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                    </button>
                    <div class="basemap-menu">
                        ${Object.keys(basemaps).map(name =>
                            `<button class="basemap-option ${name === currentBasemap ? 'active' : ''}" data-basemap="${name}">
                                ${name}
                            </button>`
                        ).join('')}
                    </div>
                `;

                // Prevent map events when clicking on control
                L.DomEvent.disableClickPropagation(div);
                L.DomEvent.disableScrollPropagation(div);

                // Toggle menu visibility
                const toggleBtn = div.querySelector('.basemap-toggle-btn');
                const menu = div.querySelector('.basemap-menu');

                toggleBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    menu.classList.toggle('show');
                });

                // Close menu when clicking outside
                document.addEventListener('click', () => {
                    menu.classList.remove('show');
                });

                // Handle basemap selection
                menu.addEventListener('click', (e) => {
                    if (e.target.classList.contains('basemap-option')) {
                        const selectedBasemap = e.target.dataset.basemap;
                        switchBasemap(map, selectedBasemap);

                        // Update active state
                        menu.querySelectorAll('.basemap-option').forEach(btn => btn.classList.remove('active'));
                        e.target.classList.add('active');

                        menu.classList.remove('show');
                    }
                });

                return div;
            };

            return control;
        }

        function switchBasemap(map, basemapName) {
            // Remove current basemap
            if (map.currentBasemapLayer) {
                map.removeLayer(map.currentBasemapLayer);
            }

            // Add new basemap
            map.currentBasemapLayer = basemaps[basemapName];
            map.currentBasemapLayer.addTo(map);

            // Update current basemap reference
            currentBasemap = basemapName;
        }

        // Initialize map
        const map = L.map('map').setView([37.8, -85.0], 7);

        // Add default basemap
        map.currentBasemapLayer = basemaps[currentBasemap];
        map.currentBasemapLayer.addTo(map);

        // Add basemap control
        const basemapControl = createBasemapControl(map);
        basemapControl.addTo(map);
    </script>
</body>
</html>
